
<div class = "result-to-hide" id="result-to-hide">
    <div class="table-container">
        <table>
            <tr>
                <th>
                    PARK TYPE
                </th>
                <th>
                    FID
                </th>
                <th>
                    NAME
                </th>
                <th>
                    SQMI
                </th>
                <th>
                    AREA
                </th>
                <th>
                    PERIMETER
                </th>
            </tr>

            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
            <tr>
                <td data-cell = "PARK-TYPE">Regional Park</td>
                <td data-cell = "FID">12345</td>
                <td data-cell = "NAME">Fish Springs National Wildlife Refuge</td>
                <td data-cell = "SQMI">28.08</td>
                <td data-cell = "AREA">123564241.83</td>
                <td data-cell = "PERIMETER">8589.80</td>
            </tr>
        </table>
    </div>
    <!-- paragraph -->
    <div class = "result-message">
        <p>Your Results will be displayed here.</p>
    </div>
</div>

<div class = "result-to-show" id = "result-to-show" style="display: none;">
   <div class="table-result">
        <table>
            <thead>
                <tr>
                    {% for column in columns %}
                    <th>{{column}}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% if result %}
                <script>
                    document.getElementById('result-to-hide').style.display = 'none';
                    document.getElementById('result-to-show').style.display = 'block';
                    document.addEventListener('DOMContentLoaded', function() {
                        // Convert the drawn_json to a format that JavaScript can understand
                        var geojson = {{ drawn_json | tojson | safe }};
                        // console.log("geojson value is  : ",geojson)
                        // Check if geojson has valid data
                        if (geojson && geojson.features && geojson.features.length > 0) {
                            // Access the already-initialized map from map.js
                            // Assuming `map` is the variable holding your map instance
                            if (typeof map !== 'undefined') {
                                // Add GeoJSON layer to the map
                                L.geoJSON(geojson).addTo(map);
                                // Optionally zoom to the bounds of the GeoJSON layer
                                var bounds = L.geoJSON(geojson).getBounds();
                                map.fitBounds(bounds);
                            } else {
                                console.error("Map instance not found. Make sure map.js is correctly loaded and initialized.");
                            }
                        } else {
                            console.error("No valid GeoJSON data found.");
                        }
                    });
                </script>
                    {% for stat in result['stats'] %}
                    <tr>
                        <td><a href="getData/fid" class="fid-link" data-fid="{{stat['FID']}}">{{ stat['FID'] }}</a></td>
                        <td>{{ stat['NAME'] }}</td>
                        <td>{{ stat['SQMI'] | round(2) }}</td>
                        <td>{{ stat['FEATTYPE'] }}</td>
                        <td>{{ stat['Shape__Are'] | round(2)}}</td>
                        <td>{{ stat['Shape__Len'] | round(2) }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="{{ column_headers|length }}">No data available Yet</td></tr>
                {% endif %}
            </tbody>
        </table>
   </div>
</div>
<script>
    // Declare a variable to store the current marker
    let currentMarker = null;

    function fetch_data(fid){
        fetch(`/getData/${fid}`)
            .then(response => response.json())
            .then(data => {
                // console.log("data is : ", data);
                // console.log("x_cords : ", data["POINT_X"]);
                // console.log("y_cord is : ",data["POINT_Y"]);
                if (typeof map !== 'undefined') {
                // Remove the existing marker if it exists
                if (currentMarker) {
                    map.removeLayer(currentMarker);
                }

                // Create a new marker and add it to the map
                currentMarker = L.marker([data["POINT_Y"], data["POINT_X"]]);
                currentMarker.addTo(map);
                currentMarker.bindPopup(`Name : ${data["NAME"]}`).openPopup();
                }
            })
            .catch(error => {
                console.log("error in fetching data : ", error);
            });
    }
    document.querySelectorAll('.fid-link').forEach(link => {
        link.addEventListener('click', function(event){
            event.preventDefault();
             // Reset the color of all links
            document.querySelectorAll('.fid-link').forEach(l => l.style.color = '');
            this.style.color = 'red';
            const fid_value = this.getAttribute('data-fid');
            console.log("fid value is : ", fid_value)
            fetch_data(fid_value);
        });
    });
</script>
